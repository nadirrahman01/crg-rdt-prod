<!-- index.html -->
<!-- NOTE: Only additions made (no removals). Adds target price + stats boxes under the price chart panel,
     and adds CRG Rating selector with an info popover (Equity Research only). -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CRG - Research Documentation Tool</title>
  <link rel="stylesheet" href="assets/styles.css">

  <!-- Chart.js (for price chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">

    <header class="hero">
      <h1 class="hero-title">CRG - Research Documentation Tool</h1>
    </header>

    <form id="researchForm">
      <!-- Note Type -->
      <label for="noteType">Type of Note</label>
      <select id="noteType" required>
        <option value="">Select note type...</option>
        <option value="General Note">General Note</option>
        <option value="Equity Research">Equity Research</option>
        <option value="Macro Research">Macro Research</option>
        <option value="Fixed Income Research">Fixed Income Research</option>
        <option value="Commodity Insights">Commodity Insights</option>
      </select>

      <!-- Title -->
      <label for="title">Title</label>
      <input type="text" id="title" required placeholder="Enter research title...">

      <!-- Topic -->
      <label for="topic">Topic</label>
      <input type="text" id="topic" required placeholder="Enter topic...">

      <!-- Primary Author -->
      <label for="authorLastName">Primary Author — Last Name</label>
      <input type="text" id="authorLastName" required placeholder="e.g., Rahman">

      <label for="authorFirstName">Primary Author — First Name</label>
      <input type="text" id="authorFirstName" required placeholder="e.g., Nadir">

      <label for="authorPhone">Primary Author — Phone</label>
      <input type="text" id="authorPhone" required placeholder="e.g., 44-7398344190">

      <!-- Co-Authors Section -->
      <div id="coAuthorsSection" class="panel">
        <div class="panel-head">
          <div class="panel-title">
            Co-Authors <span class="panel-muted">(Optional)</span>
          </div>
          <button type="button" id="addCoAuthor" class="btn btn-secondary">+ Add Co-Author</button>
        </div>

        <div id="coAuthorsList"></div>
      </div>

      <!-- Equity Research: Model & Valuation Attachments -->
      <div id="equitySection" class="equity-section" style="display:none;">
        <div class="equity-header">
          <div class="equity-title">Equity Research — Model & Valuation</div>
          <div class="equity-subtitle">
            Attach your DCF / Excel model and capture assumptions so the note is auditable.
          </div>
        </div>

        <label for="ticker">Ticker / Company</label>
        <input type="text" id="ticker" placeholder="e.g., MSFT (Microsoft)">

        <!-- NEW: CRG Rating (Equity Research) -->
        <div class="rating-row">
          <label for="crgRating" class="rating-label">
            CRG Rating
            <span class="info-badge" tabindex="0" aria-label="Rating definitions">i</span>
            <span class="info-pop">
              <strong>Outperform (O)</strong>: Expected to materially outperform sector average over 12 months.<br><br>
              <strong>Sector Perform (SP)</strong>: Returns expected to be in line with sector average over 12 months.<br><br>
              <strong>Underperform (U)</strong>: Returns expected to be materially below sector average over 12 months.<br><br>
              <strong>Restricted (R)</strong>: CRG policy precludes certain types of communications, including an investment recommendation, when CRG is acting as an advisor in certain merger or other strategic transactions and in certain other circumstances.<br><br>
              <strong>Not Rated (NR)</strong>: The rating, price targets and estimates have been removed due to applicable legal, regulatory or policy constraints which may include when CRG is acting in an advisory capacity involving the company.
            </span>
          </label>

          <select id="crgRating" class="crg-rating-select">
            <option value="" selected>Select rating...</option>
            <option value="Outperform (O)">Outperform (O)</option>
            <option value="Sector Perform (SP)">Sector Perform (SP)</option>
            <option value="Underperform (U)">Underperform (U)</option>
            <option value="Restricted (R)">Restricted (R)</option>
            <option value="Not Rated (NR)">Not Rated (NR)</option>
          </select>
        </div>
        <!-- /NEW -->

        <!-- Price Chart Panel (existing) -->
        <div class="chart-panel">
          <div class="chart-head">
            <div class="chart-title">Price Chart</div>
            <div class="chart-actions">
              <select id="chartRange" class="chart-range">
                <option value="6mo" selected>6M</option>
                <option value="1y">1Y</option>
                <option value="2y">2Y</option>
                <option value="5y">5Y</option>
              </select>
              <button type="button" id="fetchPriceChart" class="btn btn-secondary">Fetch chart</button>
            </div>
          </div>

          <div id="chartStatus" class="help-text" style="margin-top: 6px;"></div>

          <div class="chart-wrap">
            <canvas id="priceChart" height="140"></canvas>
          </div>

          <!-- NEW: Target price + stats -->
          <label for="targetPrice" style="margin-top: 14px;">Target Price <span class="panel-muted">(Optional)</span></label>
          <input type="text" id="targetPrice" placeholder="e.g., 520">

          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-label">Current Price</div>
              <div class="metric-value" id="currentPrice">—</div>
            </div>

            <div class="metric-card">
              <div class="metric-label">Volatility (ann.)</div>
              <div class="metric-value" id="realisedVol">—</div>
            </div>

            <div class="metric-card">
              <div class="metric-label">Return (range)</div>
              <div class="metric-value" id="rangeReturn">—</div>
            </div>

            <div class="metric-card">
              <div class="metric-label">Upside to Target</div>
              <div class="metric-value" id="upsideToTarget">—</div>
            </div>
          </div>
          <!-- /NEW -->
        </div>

        <label for="modelFiles">Upload Model Files (Excel / PDF) <span class="panel-muted">(Optional)</span></label>
        <p class="help-text"><em>Tip: Upload the Excel model (.xlsx/.xlsm) and any exported summary tabs as PDF if you have them.</em></p>
        <input type="file" id="modelFiles" multiple accept=".xlsx,.xlsm,.xls,.csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,application/pdf">

        <label for="modelLink">Model Link (Drive / SharePoint) <span class="panel-muted">(Optional)</span></label>
        <input type="text" id="modelLink" placeholder="Paste a share link to the model">

        <label for="valuationSummary">Valuation Summary <span class="panel-muted">(Optional)</span></label>
        <textarea id="valuationSummary" rows="6" placeholder="Example: Base-case FV per share, current price, implied upside/downside, and 2–3 lines on the main driver(s)."></textarea>

        <label for="keyAssumptions">Key Assumptions <span class="panel-muted">(Optional)</span></label>
        <textarea id="keyAssumptions" rows="7" placeholder="Example:
WACC: 8.5%
Terminal growth: 2.0%
Revenue CAGR (5y): 7%
EBIT margin (exit): 28%
Tax rate: 19%
Net debt: £X
Shares: X"></textarea>

        <label for="scenarioNotes">Scenario / Sensitivity Notes <span class="panel-muted">(Optional)</span></label>
        <textarea id="scenarioNotes" rows="5" placeholder="Example: What breaks the thesis? What is the bear/base/bull driver? Any sensitivity highlights (WACC / g / margin)?"></textarea>
      </div>

      <!-- Key Takeaways -->
      <label for="keyTakeaways">Key Takeaways</label>
      <textarea id="keyTakeaways" rows="6" required placeholder="Enter key takeaways (use bullet points with - or *)..."></textarea>

      <!-- Analysis and Commentary -->
      <label for="analysis">Analysis and Commentary</label>
      <textarea id="analysis" rows="8" required placeholder="Enter your analysis and commentary..."></textarea>

      <!-- Additional Content -->
      <label for="content">Additional Content <span class="panel-muted">(Optional)</span></label>
      <textarea id="content" rows="10" placeholder="Enter any additional detailed content..."></textarea>

      <!-- The Cordoba View -->
      <label for="cordobaView">The Cordoba View <span class="panel-muted">(Optional)</span></label>
      <textarea id="cordobaView" rows="6" placeholder="Enter Cordoba's perspective and recommendations..."></textarea>

      <!-- Image Upload -->
      <label for="imageUpload">Upload Images / Graphs <span class="panel-muted">(Optional)</span></label>
      <p class="help-text">
        <em>Note: The filename will be used as the figure caption in the document. Name your files accordingly.</em>
      </p>
      <input type="file" id="imageUpload" multiple accept="image/*">

      <button type="submit" class="btn btn-primary">Generate Word Document</button>
    </form>

    <div id="message" class="message"></div>

  </div>

  <!-- External Libraries -->
  <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <!-- Your JavaScript -->
  <script src="assets/app.js"></script>
</body>
</html>
